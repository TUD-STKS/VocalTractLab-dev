\documentclass[]{article}
\usepackage{bm}
\usepackage{amsmath}
\usepackage{amsfonts} 
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{mathtools}
%\usepackage{breqn}
\usepackage[left=2cm, right=2cm, top=2cm, bottom=2cm]{geometry}
\usepackage{soul}
\usepackage{color}
\usepackage{hyperref}
\usepackage{bold-extra}
\usepackage{tcolorbox}
\usepackage{listings}
\usepackage[backend=bibtex]{biblatex}
\addbibresource{biblio.bib}

\newcommand*{\transp}[2][-3mu]{\ensuremath{\mskip1mu\prescript{\smash{\mathrm t\mkern#1}}{}{\mathstrut#2}}}
\newcommand{\mathcolorbox}[2]{\colorbox{#1}{$\displaystyle #2$}}
\newcommand\tab[1][1cm]{\hspace*{#1}}

%opening
\title{User guide for VocalTractLab3D}
\author{R{\'e}mi Blandin}

\begin{document}
	\maketitle
	
	\section{Introduction}
	
	VocalTractLab3D is a special version of the articulatory synthesizer
	VocalTractLab 2.3 which integrates a module that performs 3D acoustic simulations. The other modules are, to some very little differences the same as the original VocalTractLab 2.3 
	\cite{birkholz2013modeling} and the 
	reader is referred to the manual of VocalTractLab 2.3 to learn
	how to use them.
	The 3D acoustic simulations are performed with a frequency domain
	multimodal method which have been designed to be particularly 
	fast and accurate. The details of this simulation method are 
	provided in \textcite{blandin2022efficient}.
	
	\subsection{What are 3D acoustic simulations?}
	
	\textbf{What are vocal tract acoustic simulations?}\\ 
	Vocal tract acoustic simulations consists in describing how acoustic waves travel
	inside the vocal tract volume, are reflected at the discontinuities, such as 
	changes of cross-section or the mouth opening and create resonances. 
	This allows one to compute transfer functions, as an example between the acoustic volume flow created at the vocal folds and the acoustic pressure radiated in front of the lips. It can also be used to 
	compute the acoustic field, which describes the variations of the  
	properties of the acoustic waves (acoustic pressure and particle velocity) over space.
	
	\textbf{What is specific to vocal tract acoustics?}\\
	The vocal tract has an elongated shape in which the acoustic waves 
	are guided to travel mainly along its length. One can say that the
	waves are guided by the vocal tract walls and thus, from the point
	of view of wave propagation, the vocal tract can be called a 
	\emph{waveguide}.
	This property of the vocal tract makes it easy to approximate the 
	propagation of acoustic waves as a single value of acoustic 
	pressure varying along its length, thus neglecting transverse 
	variations of the acoustic field. This have lead to 1D simulation 
	methods and electrical analogies which are very widely used to 
	simulate vocal tract acoustics \cite{sondhi1987hybrid}.
	
	\textbf{What is 3D vocal tract acoustics?}\\
	Even though not very important below 4-5~kHz, 
	the acoustic field has transverse variations, and thus, varies in
	all the three dimensions of space. At low frequency these variations
	appear as a curvature of the acoustic field related to variations
	of cross-sectional dimensions \hl{Illustrate this with acoustic field pictures}. At higher frequency, the 3D nature of the acoustic field is more obvious as transverse resonances can be observed
	\hl{illustrate that}.
	
	\textbf{What does it changes to account for the 3D acoustic in comparison with using a 1D simplifying assumption?}\\
	The impact of accounting for the 3D nature of the acoustic field 
	inside the vocal tract is rather limited up to about 3~kHz. 
	It consists mainly in small changes in the resonance properties
	(frequency, amplitude and bandwidth). From 3~kHz on, the changes 
	in the resonance properties can be more substantial and above 
	4-5~kHz the transverse resonances can induce zeros and additional 
	peaks in the transfer function. \hl{Illustrate with a TF 3D vs 1D}
	
	\subsection{What can VocalTractLab3D do and not do?}
	
	\textbf{What VocalTractLab3D can do?}
	\begin{itemize}
		\item Compute the transfer function between the volume velocity
		at the location of the vocal folds and one are several points inside or outside the vocal tract.
		\item Compute the transfer function between the acoustic pressure on a transverse plane anywhere inside the vocal tract and one or several points inside or outside the vocal tract.
		This is useful to emulate noise generation by aeroacoustic 
		sound sources.
		\item Compute the input impedance of the plane mode at the 
		location of the vocal folds.
		\item Compute and visualize the transverse modes.
		\item Compute the acoustic field at a specific frequency in the sagittal plane and in transverse planes anywhere inside the vocal tract.
		\item Compute the above listed quantities for vocal tract 
		geometries generated with the articulatory model implemented 
		in VocalTractLab3D or vocal tract geometries imported from 
		external .csv file coded in a specific format. Note that in 
		this last case any waveguide geometry can be imported and not only vocal tract geometry (e.g. airways of other animals, wind instruments ...). However, the parameters of VocalTractLab3D 
		are optimized for human vocal tracts and may not be optimal for
		other applications.
		\item Synthesize vowel and fricative sounds.
	\end{itemize}

	\textbf{What VocalTractLab3D cannot do?} \\
	The simulation method implemented in VocalTractLab3D has been 
	designed primarily to be efficient, and this comes with some 
	limitations regarding the geometries which can be simulated.
	However, it is to be noted that some of the geometrical simplifications are also used with simulation methods, such as finite
	elemnents, in order to reduce the computation time, or simplify the task of describing the geometry.
	VocalTractLab3D cannot:
	\begin{itemize}
		\item Simulate continuous cross-sectional shape variations within the segments of the vocal tract geometry. The cross-sectional shape can be scaled to account for area variation, but the shape reamins constant.
		\item Simulate lip shapes. The mouth opening is contained 
		inside a plane, and thus, the 3D lip shape cannot be simulated.
		\item Simulate branches such as piriform sinus or the nasal 
		cavity.
		\item Similate the diffraction by the head and the torso outside
		of the vocal tract.
		\item Perform time domain simulation.
	\end{itemize}
	Some of the limitations listed may be overcomed with future developments of the simulation method used (3D lip shape, branches 
	and diffraction by the head and torso), and some are inherent to 
	the simulation method used (constant cross-sectional shape in the 
	segments, and frequency domain simulations).
	
	\subsection{Implementation}
	
	\hl{Put here the libraries used and cite them in possible}
	
	\subsection{Installation requirements}
	
	\subsection{How to cite VocalTractLab3D?}
	
	\fullcite{blandin2022efficient}
	
	\section{Interface}
	
	\subsection{Overview}
	
	\hl{SHOW THE INTERFACE}
	
	When VocalTractLab3D is started, it shows by default 2 windows:
	\begin{itemize}
		\item The main window showing the "3d acoustic simulation" page.
		\item A small window showing the 3D geometry corresponding to the articulatory model: the vocal tract dialog. The user can interact with the articulatory model using the control points to move the articulators. When closed, this window can be shown again by clicking on the button "Show vocal tract".
	\end{itemize}
	
	The "3d acoustic simulation" is divided in 4 panels:
	\begin{enumerate}
		\item the left panel contains buttons to manage the geometries, perform the simulations and synthesis.
		\item The middle panel shows a sagittal cut of the geometry simulated.
		\item The right panel shows a transverse cut of the geometry corresponding to a specific segment.
		\item The bottom panel shows the transfer functions and 
		input impedance computed. 
	\end{enumerate}

	\subsection{Geometries}

	\subsubsection{Defining vocal tract geometries}
	
	When VocalTractLab is started, the default geometry of the articulatory model is already loaded and ready to use for 
	simulations.
	However, the geometry can be defined or modified in several ways:
	\begin{itemize}
		\item It can be simply defined by moving the control points in
		the vocal tract dialog. When doing so, one can see the segmented 
		geometry in the central panel updating.
		\item If a speaker file containing predefined geometries is loaded, a geometry can be selected using the dialog shown by 
		clicking on the button "Vocal tract shapes" of the left panel.
		\item An external geometry can be loaded as a \texttt{.csv} file
		formated in a specific way. 
	\end{itemize}

\begin{table}
	\centering
	\begin{tabular}{c c c c c c c}
		\hline
		\texttt{Centerline} $x$ & \texttt{Normal} $x$ & 
		\texttt{Input scaling} & \texttt{Contour point 1} $y$ &  
		\texttt{Contour point 2} $y$ & ... 
		& \texttt{Contour point N} $y$ \\
		\hline
		\texttt{Centerline} $y$ & \texttt{Normal} $y$ & 
		\texttt{Output scaling} & \texttt{Contour point 1} $z$ &  
		\texttt{Contour point 2} $z$ & ... 
		& \texttt{Contour point N} $z$ \\
		\hline
	\end{tabular}
\caption{Csv file format to encode segmented vocal tract geometries.}
\label{table:csv_file_format}
\end{table}
	
	\textbf{Csv format for externally defined geometries:}\\
	The file describes a list of segments by specifying
	\begin{itemize}
		\item a centerline point,
		\item a normal,
		\item input and output scaling factors,
		\item and a contour.
	\end{itemize}
	One segment is defined on two lines: the first one describes the 
	first coordinates ($x$ or $y$) and the input scaling factor, the second one the second coordinates ($y$ or $z$) and the output scaling factor. 
	This is summarized in the Tab.~\ref{table:csv_file_format}.
	The columns must be separated by semi-columns ";". 
	An example of such \texttt{.csv} file encoding a simple waveguide
	geometry is provided in Tab.~\ref{table:example_csv_file}.
	Note that in this example the normal of the second segment is not normalized.
	In this case the normalization is done when the file is imported, otherwise
	this would be equivalent to applying a scaling factor.
	The length and curvature of a segment are defined by its centerline
	point and normal and the centerline point and normal of the 
	following segment.
	Thus, a minimal number of two segments must be provided. 
	The before-last and the last segment are defined by computing an 
	intermediate centerline point and normal between the last and 
	before last centerline points and normals provided.
	
	\begin{table}
		\centering
		\begin{tabular}{c c c c c c c }
			-2.;& -1.;& 0.5;& -1.;& -1.;& 1.;& 1.; \\
			0.;& 0.;& 1.;& -1.;& 1.;& 1.;& -1.; \\
			-1.4142;& -0.5;& 1.;& -1.;& -1.;& 1.;& 1.; \\
			1.4142;& 0.5;& 1.5;& -1.;& 1.;& 1.;& -1.; 
		\end{tabular}
		\caption{Example of \texttt{.csv} file which can be imported to generate a waveguide geometry.}
		\label{table:example_csv_file}
	\end{table}

	The geometry can also be exported in the same format through 
	the context menu which appear with a right click on the central panel
	"Export geometry in a csv file". 
	
	It can be chosen to take into account or not the curvature and 
	the area variations of the segments. This is done using the 
	simulation parameters dialog displayed by clicking on the 
	button "Simulation parameters" in the left panel. 
	These options are found in the "Geometry options" section.
	When "Varying area" is check, the variation of area are taken into 
	account through the scaling factor which is set to vary linearly
	between its value at the entrance and the exit of the segments (these values are displayed in the information of the right panel).
	The variations of the scaling factor can be computed in two different
	ways, or directly provided by the user when the geometry is loaded 
	as a \texttt{.csv} file. These options can be selected in the 
	"Geometry options" as well. One scaling factor computation method, 
	"Area", 
	consists simply in linearly interpolating the cross-sectional area.
	The other one, "Bounding box", interpolates the largest dimension of the bounding 
	box of the segments, provided that the resulting scaled contour 
	do not exceed the area of the following contour, in which case it 
	is set to interpolate the area. 
	Finaly, one can specify that the scaling factors provided in the 
	input \texttt{.csv} file must be used by selecting "From file".
	

	\subsubsection{Visualizing the vocal tract geometry}
	
	The geometry is visualized both in the central and the right panels.
	The central panel shows a sagittal cut of the bounding box of the 
	segments. This bounding box is a rectangle whose dimensions are 
	the maximal and minimal dimensions of the cross-sectional 
	contour.
	
	This sagittal cut of the segments can be exported as a list of 
	coordinates in a text file using the context menu of the central 
	panel "Export segment picture".
	This can be used to plot the same picture with other softwares such 
	as Matlab. This can be easily done with this kind of Matlab code:
	\begin{lstlisting}
	file_name = "segment_picture.txt";
	load(file_name);
	plot(segment_picture(:,1), segment_picture(:,2));
	\end{lstlisting}
	
	When cliking on a segment, its outline becomes red to confirm that
	it has been selected, and the contour and some information 
	regarding the segment are displayed in the right panel.
	When the geometry is provided by the articulatory model, it is 
	possible to identify the type of surfaces which constitutes the 
	edges of the the contour (tongue, teeth, lips, air at the lip corner, uvula, epiglottis and other walls \hl{check other surfaces}).
	The color code for these different surfaces is given in 
	Fig.\hl{PUT A FIGURE WITH THE COLOR CODE OF THE SURFACES}.
	By clicking on the arrows "<" and ">" at the bottom of the right  
	panel, one can display the contour with its original dimensions 
	("Mode computation size") and scaled at the entrance and exit of the
	segment.
	
	The coordinates of the points of the contour can also be exported 
	in a text file through the context menu of the right panel obtained
	with a right click "Export contour in text file". 
	Note that the contour exported has the scaling with which it is 
	displayed: if at this entrance the scaling is 0.5 and the entrance 
	contour is displayed, the coordinate of the exported contour will
	be the ones of the original contour multiplied by 0.5.
	The exported contour can easily be plotted using another software in 
	the same way as the segment picture.
	
	\hl{Speak about centerline}
	
	\subsection{Transverse modes}
	
	\subsubsection{Computation of the transverse modes}
	
	The transverse modes can be computed by clicking the button
	"Compute modes" of the left panel. This can be useful if one is interested in analyzing the transverse modes only without 
	computing the acoustic field or the transfer functions.
	
	The computation of the transverse modes is parametrized by two 
	paramaters: 
	\begin{itemize}
		\item the density of the mesh which is used to solve with 
		\hl{2D finite elements} the 
		eigenvalue problem giving the transverse modes and their 
		associated cutoff frequencies. This is related to the average
		side length of the elements through the relationship
		$average~side~length = \frac{\sqrt{cross-sectional~area}}{mesh~density}$. 
		The mesh density is thus, an indication of the number of
		elements per characteristic length.
		\item The maximal cutoff frequency. It is a upper limit for the 
		cutoff frequency of the transverse modes included in the 
		simulations: for a given segment, only the modes having a cutoff
		frequency lower than this value are kept. Thus, segments having 
		a small cross-section have less transverse modes than the ones
		having a bigger one. This is done so to increase the efficiency 
		of the simulations.
	\end{itemize}

	The cutoff frequency is related to the sound speed, which itself 
	is related to the temperature. Both the sound speed and the 
	temperature can be set in the "Physical constants" section of 
	the "Simulation parameters" dialog. Since both quantities are
	related, they cannot be modified independantly: changing the 
	temperature will change the sound speed and conversely.

	\subsubsection{Visualization of the transverse modes}
	
	The mesh used to compute the transverse modes can be visualized
	in the right panel by selecting "Mesh" in the bottom.
	The transverse modes can be visualized by 
	selecting "Modes" at the bottom. 
	One can browse the different modes using the arrows "<" and ">".
	The amplitude variation of the modes is displayed, and its cutoff 
	frequency is given in the text information.
	
	\subsection{Transfer functions}
	
	\subsubsection{Computation of the transfer functions}
	
	The transfer functions can be computed by clicking on the button 
	"Compute transfer functions" in the left panel.
	
	The computation of the transfer function requires to solve the 
	walve problem. In this purpose, the simulation of wave propagation can be achieved either with an anlytical 
	solution \cite{blandin2015effects} or a numerical Magnus-MÃ¶bius 
	scheme \cite{PAGNEUX20101834}.
	This can be selected in the section "Numerical scheme options" of
	the "Simulation parameters" dialog. The analytical solution is 
	enabled by selecting "Straight". However, this solution has strong limitations regarding the geometry and the losses: it cannot take into account the curvature, cross-sectional area variations and 
	wall losses. The numerical scheme is enabled by selecting "Magnus".
	In this case a number of integration steps is given and can be 
	modified if necessary. This number is the same for each segment.
	Note that since the segmentation generally used for vocal tract geometries gives segments having approximately the same length, 
	this parameters is expected to affect the accuracy in a similar way
	for each segment. However, for other applications for which the 
	segment length would be inhomogeneous, this parameter need to be considered more carefully.
	
	The boundary conditions can be set in the "Boundary conditions options" section of the "Simulation parameters" dialog. 
	It includes the mouth boundary condition which can be described
	with a radiation boundary condition computed following 
	\textcite{blandin2019multimodal},
	or a zero pressure condition.
	Several types of wall losses can be selected: 
	\begin{itemize}
		\item "Visco-thermal losses" includes frequency dependent 
		visco-thermal losses implemented according to 
		\textcite{bruneau1987boundary},
		\item "Soft Walls" includes frequency dependent losses 
		corresponding to soft walls \hl{[find ref]}
		\item "Constant wall admittance" includes a frequency
		independent wall admittance whose real and imaginary parts 
		can be set by the user.
	\end{itemize}

	\hl{Maximal frequency and frequency steps}
	
	\hl{noise source location}
	
	\hl{Reception points}
	
	\subsubsection{Visualization of the transfer functions}
	
	\hl{bottom panel}
	
	\hl{exportation of the transfer functions}
	
	\printbibliography
%	\bibliography{biblio}
%	\bibliographystyle{plain}

\end{document}